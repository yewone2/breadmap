

<html layout:decorate="~{layout}">
<div layout:fragment="content" class="container my-3">

<!-- ê²Œì‹œê¸€ -->
<ul class="review_detail">
	<div class="subject" th:text="${question.subject}"></div>
	<div class="author" th:if="${question.author != null}" th:text="${question.author.username}"></div>
	<div class="date" th:text="${question.modifyDate != null ? #temporals.format(question.modifyDate, 'yyyy-MM-dd HH:mm') : #temporals.format(question.createDate, 'yyyy-MM-dd HH:mm')}"></div><br>
	<div class="content" th:text="${question.content}"></div>

		<div class="my-3">
		
				ì¢‹ì•„ìš” 
				
			</button>

			<button th:href="@{|/review/modify/${question.id}|}"
				sec:authorize="isAuthenticated()"
				th:if="${question.author != null and #authentication.getPrincipal().getUsername() == question.author.username}"
				th:text="ìˆ˜ì •"></button>
				

			<button onclick="javascript:void(0);" th:data-uri="@{|/review/delete/${id}|}"
				class="delete btn btn-sm btn-outline-secondary" sec:authorize="isAuthenticated()"
				th:if="${question.author != null and #authentication.getPrincipal().getUsername() == question.author.username}"
				th:text="ì‚­ì œ"></button>
		</div>

<!-- ë‹µë³€ì˜ ê°¯ìˆ˜ í‘œì‹œ -->

â¤ï¸ <span th:text="${#lists.size(question.voter)}"></span>
<h5 class="answer-count" th:text="|ì¢‹ì•„ìš” ${#lists.size(question.voter)}"></h5>
<h5 class="answer-count" th:text="|ğŸ’¬ ëŒ“ê¸€ ${#lists.size(question.answerList)}|"></h5>

<!-- ë‹µë³€ ë°˜ë³µ ì‹œì‘ -->
<div class="answer" th:each="answer, loop : ${ans_paging}">
	<div class="answer-header">
	<div class="answer-author" th:text="${answer.author.username}"></div>
    
    <!-- ë“œë¡­ë‹¤ìš´ ë©”ë‰´ë¥¼ ì—¬ëŠ” ë²„íŠ¼ -->
<div class="dot-menu" sec:authorize="isAuthenticated()" onclick="toggleDropdown()">
    <span>â‹®</span> 
    <div class="dropdown" id="dropdown-menu">
		<!--<a href="javascript:void(0);" onclick="editComment(${answer.id})">ìˆ˜ì •</a>-->
		<a href="javascript:void(0);" th:data-uri="@{|/answer/delete/${answer.id}|}">ì‚­ì œ</a>
	</div>
</div>
</div>

	<div class="answer-body">
		<div class="answer-content" th:text="${answer.content}"></div>
			<div class="answer-info">
			<div class="answer-date" th:text="${#temporals.format(answer.createDate, 'yyyy-MM-dd HH:mm')}"></div>
		<a href="javascript:void(0);" class="recommend btn"
		th:data-uri="@{|/answer/vote/${answer.id}|}">
		â¤ï¸ <span class="badge" th:text="${#lists.size(answer.voter)}"></span>
		</a>
	</div>
	<div class="modify-info" th:if="${answer.modifyDate != null}">
		<span>ìˆ˜ì •ë¨: </span>
		<span th:text="${#temporals.format(answer.modifyDate, 'yyyy-MM-dd HH:mm')}"></span>
	</div>
  </div>
</div>
    
<!-- ìˆ˜ì • ë²„íŠ¼ 
	<a href="@{|/answer/modify/${answer.id}|}" class="btn modify-btn" sec:authorize="isAuthenticated()"
		th:if="${answer.author != null and #authentication.getPrincipal().getUsername() == answer.author.username}"
		th:text="ìˆ˜ì •"></a>
    
  ì‚­ì œ ë²„íŠ¼
	<a href="javascript:void(0);" class="btn delete-btn" th:data-uri="@{|/answer/delete/${answer.id}|}"
	th:if="${answer.author != null and #authentication.getPrincipal().getUsername() == answer.author.username}">
		ì‚­ì œ </a> --> 
		<!-- ë‹µë³€ ì‘ì„± -->

<form th:action="@{|/answer/create/${question.id}|}" th:object="${answerForm}" method="post" class="comment-box">
	<div class="comment-form">
		
		
	<div th:replace="~{form_errors :: formErrorsFragment}"></div>
	<div class=comment-user th:text="${question.author.username}"></div>
		<textarea sec:authorize="isAnonymous()" disabled th:field="*{content}" class="form-control" rows="10"></textarea>
		<textarea sec:authorize="isAuthenticated()" th:field="*{content}" class="comment-input"></textarea>
		<input type="submit" value="ë“±ë¡" class="submit-button">
	</div>
</form>

<!-- ë‹µë³€ ë°˜ë³µ ë  -->


	
<!-- ë‹µë³€ í˜ì´ì§• ì²˜ë¦¬ ì‹œì‘ -->
<div th:if="${!ans_paging.isEmpty()}">
	<ul class="pagination justify-content-center">
		<li class="page-item" th:classappend="${!ans_paging.hasPrevious} ? 'disabled'">
			<a class="page-link" th:href="@{|?ans-page=${ans_paging.number-1}|}" th:data-page="${ans_paging.number-1}">
				<span>ì´ì „</span>
			</a>
		</li>
		<li th:each="page: ${#numbers.sequence(0, ans_paging.totalPages-1)}"
			th:if="${page >= ans_paging.number - 5 and page <= ans_paging.number+5}"
			th:classappend="${page == ans_paging.number} ? 'active'"
			class="page-item">
			<a th:text="${page}" class="page-link" th:href="@{|?ans-page=${page}|}" th:data-page="${page}"></a>
		</li>
		<li class="page-item" th:classappend="${!ans_paging.hasNext()} ? 'disabled'">
			<a class="page-link" th:href="@{|?ans-page=${ans_paging.number+1}|}" th:data-page="${ans_paging.number+1}">
				<span>ë‹¤ìŒ</span>
			</a>
		</li>
	</ul>
</div>

<script layout:fragment="script" type="text/javascript">
  // 'delete' í´ë˜ìŠ¤ë¥¼ ê°€ì§„ ëª¨ë“  ìš”ì†Œë¥¼ ì°¾ì•„ì„œ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
  const delete_elements = document.getElementsByClassName("delete");
  Array.from(delete_elements).forEach(function(element) {
      element.addEventListener('click', function() {
          if (confirm("ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
              location.href = this.dataset.uri;
          }
      });
  });
  
const recommend_elements = document.getElementsByClassName("recommend");
Array.from(recommend_elements).forEach(function(element) {
    element.addEventListener('click', function() {
        if(confirm("ì •ë§ë¡œ ì¶”ì²œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            location.href = this.dataset.uri;
        };
    });
});

  // ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ë³´ì´ê¸°/ìˆ¨ê¸°ê¸° í•¨ìˆ˜
  function toggleDropdown() {
    const dropdown = document.getElementById("dropdown-menu");
    dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
  }

  // ìˆ˜ì • ê¸°ëŠ¥ (ì˜ˆì œ)
	function editComment() {
		window.location.href='/answer/modify/${answerId}'; 
		toggleDropdown(); // ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ìˆ¨ê¸°ê¸°
  }

  // ì‚­ì œ ê¸°ëŠ¥ (ì˜ˆì œ)
  function deleteComment() {
    alert("ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
    toggleDropdown(); // ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ìˆ¨ê¸°ê¸°
  }

  // ë©”ë‰´ë¥¼ í´ë¦­ ì™¸ ë‹¤ë¥¸ ë¶€ë¶„ í´ë¦­ì‹œ ë‹«ê¸°
  window.onclick = function(event) {
    if (!event.target.matches('.dot-menu') && !event.target.matches('.dot-menu span')) {
      document.getElementById("dropdown-menu").style.display = "none";
    }
  }
</script>

</html>
